# Telegram бот для медицинской клиники

Бот для обслуживания пациентов клиники с функционалом вопросов и ответов между пациентами и врачами.

## Функционал

- ✅ Проверка подписки на канал перед использованием бота
- ✅ Две роли: Пациент (пользователь) и Врач
- ✅ Пациенты отправляют вопросы
- ✅ Врачи получают вопросы и отвечают на них
- ✅ Автоматическая доставка ответов пациентам
- ✅ База данных SQLite для хранения данных

## Установка и настройка

### 1. Клонирование и установка зависимостей

```bash
# Установка зависимостей
pip install -r requirements.txt
```

### 2. Настройка переменных окружения

Создайте файл `.env` на основе `.env.example`:

```bash
cp .env.example .env
```

Откройте `.env` и укажите:

- `BOT_TOKEN` - токен вашего бота от [@BotFather](https://t.me/BotFather)
- `CHANNEL_ID` - ID или username канала, на который должны подписываться пользователи

#### Как получить BOT_TOKEN:

1. Напишите [@BotFather](https://t.me/BotFather) в Telegram
2. Отправьте команду `/newbot`
3. Следуйте инструкциям для создания бота
4. Скопируйте полученный токен

#### Как получить CHANNEL_ID:

**Для публичного канала:**
- Используйте username канала: `@your_channel_username`

**Для приватного канала:**
1. Добавьте бота в канал как администратора
2. Отправьте любое сообщение в канал
3. Перейдите по ссылке: `https://api.telegram.org/bot<BOT_TOKEN>/getUpdates`
4. Найдите `"chat":{"id":-1001234567890}` - это и есть ID канала
5. Используйте числовой ID: `-1001234567890`

### 3. Настройка бота в канале

**Важно:** Добавьте вашего бота в канал как администратора, чтобы он мог проверять подписки пользователей и определять врачей.

### 4. Настройка врачей

**Автоматическое определение:** Врачи определяются автоматически по их роли в канале Telegram. Если пользователь является администратором или создателем канала, он автоматически считается врачом.

**Альтернативный способ:** Если нужно назначить врача вручную, используйте команду `/setdoctor <user_id>` (команда остается доступной для резервного варианта).

Чтобы узнать свой user_id:
1. Напишите боту [@userinfobot](https://t.me/userinfobot)
2. Скопируйте ваш ID

## Запуск

```bash
python bot.py
```

## Использование

### Для пациентов:

1. Подпишитесь на канал
2. Начните общение с ботом командой `/start`
3. Отправьте ваш вопрос боту
4. Дождитесь ответа от врача

### Для врачей:

1. Убедитесь, что вы являетесь администратором или создателем канала (роль определяется автоматически)
2. Вы будете получать вопросы от пациентов
3. Ответьте на сообщение с вопросом (используйте Reply)
4. Ваш ответ автоматически отправится пациенту

## Структура проекта

```
medicalbot/
├── bot.py              # Основной файл бота
├── database.py         # Модуль работы с базой данных
├── config.py           # Конфигурация
├── requirements.txt    # Зависимости
├── .env.example        # Пример файла с переменными окружения
├── .env                # Файл с переменными окружения (создается вручную)
├── medical_bot.db      # База данных SQLite (создается автоматически)
└── README.md           # Документация
```

## База данных

Бот использует SQLite базу данных с следующими таблицами:

- `users` - пользователи (пациенты и врачи)
- `questions` - вопросы от пациентов
- `answers` - ответы врачей

База данных создается автоматически при первом запуске.

## Безопасность

В продакшене рекомендуется:

- Добавить проверку прав администратора для команды `/setdoctor`
- Использовать более надежную систему аутентификации врачей
- Регулярно делать резервные копии базы данных
- Использовать переменные окружения для чувствительных данных

## Лицензия

Этот проект создан для использования в медицинской клинике.

